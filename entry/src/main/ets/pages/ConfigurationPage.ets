import { hdsEffect, HdsNavigation, HdsNavigationAttribute, HdsNavigationTitleMode, ScrollEffectType } from '@kit.UIDesignKit';
import { AuthUtil, LogUtil, ToastUtil } from '@pura/harmony-utils';
import { userAuth } from '@kit.UserAuthenticationKit';
import userIAM_userAuth from '@ohos.userIAM.userAuth';
import { TokenUsageChart } from '../components/TokenUsageChart';
import { THEMES } from '../model/Theme';

const TITLE_BAR_HEIGHT_MINI: number = 110;
const AUTH_SUCCESS_CODE: number = userAuth.UserAuthResultCode.SUCCESS

// é€‰é¡¹é€‰æ‹©å™¨åº•éƒ¨å¼¹å‡ºç»„ä»¶
@Component
struct OptionSelectorSheet {
  title: string = '';
  description: string = '';
  options: string[] = [];
  @Prop selectedIndex: number = 0;
  @Prop isDarkMode: boolean = true;
  @Prop isLightEffectBright: boolean = true;
  onSelect: (index: number) => void = () => {};
  onClose: () => void = () => {};
  @StorageLink('themeColorIndex') themeColorIndex: number = 0;

  @State itemScales: number[] = [];
  @State itemOpacities: number[] = [];
  @State pressedIndex: number = -1;
  @State headerOpacity: number = 0;
  @State headerOffsetY: number = -20;
  @State activeChipIndex: number = -1; // ç”¨äºè¿½è¸ªå½“å‰æ¿€æ´»çš„é€‰é¡¹

  aboutToAppear() {
    this.itemScales = this.options.map(() => 0.85);
    this.itemOpacities = this.options.map(() => 0);
    
    // æ ‡é¢˜åŠ¨ç”»
    setTimeout(() => {
      animateTo({
        duration: 300,
        curve: Curve.FastOutSlowIn
      }, () => {
        this.headerOpacity = 1;
        this.headerOffsetY = 0;
      });
    }, 50);
    
    // é€ä¸ªåŠ¨ç”»æ˜¾ç¤ºé€‰é¡¹
    this.options.forEach((_, i) => {
      setTimeout(() => {
        animateTo({
          duration: 280,
          curve: Curve.FastOutSlowIn
        }, () => {
          this.itemScales[i] = 1.0;
          this.itemOpacities[i] = 1.0;
        });
      }, 120 + i * 35);
    });
  }

  build() {
    Column() {
      // é¡¶éƒ¨æ‹–åŠ¨æŒ‡ç¤ºæ¡
      Row()
        .width(40)
        .height(4)
        .borderRadius(2)
        .backgroundColor('#50FFFFFF')
        .margin({ top: 12, bottom: 20 })

      // æ ‡é¢˜åŒºåŸŸ
      Column() {
        Text(this.title)
          .fontSize(22)
          .fontWeight(FontWeight.Bold)
          .fontColor(Color.White)
          .margin({ bottom: 6 })

        // æè¿°
        if (this.description) {
          Text(this.description)
            .fontSize(13)
            .fontColor('#BBFFFFFF')
            .textAlign(TextAlign.Center)
            .maxLines(2)
            .textOverflow({ overflow: TextOverflow.Ellipsis })
        }
      }
      .opacity(this.headerOpacity)
      .offset({ y: this.headerOffsetY })
      .margin({ bottom: 20, left: 24, right: 24 })

      // é€‰é¡¹ç½‘æ ¼
      Flex({ wrap: FlexWrap.Wrap, justifyContent: FlexAlign.Center }) {
        ForEach(this.options, (option: string, index: number) => {
          this.OptionChip(option, index)
        })
      }
      .width('100%')
      .padding({ left: 12, right: 12 })

      // å®ŒæˆæŒ‰é’®
      Button('å®Œæˆ')
        .width('90%')
        .height(50)
        .fontSize(16)
        .fontWeight(FontWeight.Bold)
        .fontColor(THEMES[this.themeColorIndex].primaryColor)
        .backgroundColor('#F5FFFFFF')
        .borderRadius(25)
        .margin({ top: 28, bottom: 28 })
        .onClick(() => this.onClose())
    }
    .width('100%')
    .padding({ bottom: 16 })
    .backgroundColor(Color.Transparent)
    .backgroundBlurStyle(BlurStyle.BACKGROUND_ULTRA_THICK)
    .borderRadius({ topLeft: 28, topRight: 28 })
    .linearGradient({
      angle: 180,
      colors: this.isDarkMode
        ? [['#FF000000', 0.0], ['#FF000000', 1.0]]
        : [[THEMES[this.themeColorIndex].primaryColor.replace('#', '#E0'), 0.0], [THEMES[this.themeColorIndex].primaryColor.replace('#', '#F0'), 1.0]]
    })
  }

  @Builder
  OptionChip(option: string, index: number) {
    // ä½¿ç”¨ Column ä½œä¸ºå›ºå®šå°ºå¯¸å®¹å™¨ï¼Œé˜²æ­¢å†…éƒ¨å˜åŒ–å½±å“å¸ƒå±€
    Column() {
      Text(option)
        .fontSize(15)
        .fontWeight(FontWeight.Medium) // å›ºå®šå­—é‡ï¼Œé¿å…å®½åº¦å˜åŒ–
        .fontColor(this.selectedIndex === index ? THEMES[this.themeColorIndex].primaryColor : Color.White)
        .textAlign(TextAlign.Center)
        .transition(TransitionEffect.OPACITY.animation({ duration: 200, curve: Curve.EaseOut }))
    }
    .padding({ left: 20, right: 20, top: 12, bottom: 12 })
    .backgroundColor(this.selectedIndex === index
      ? Color.White
      : (this.pressedIndex === index ? '#33FFFFFF' : '#14FFFFFF'))
    .borderRadius(20)
    .margin(5)
    .opacity(this.itemOpacities[index] ?? 1)
    // ä»…åœ¨é€‰ä¸­æ—¶åŠ æŸ”å’Œä¸»é¢˜æè¾¹
    .border({
      width: 1.5,
      color: this.selectedIndex === index
        ? THEMES[this.themeColorIndex].primaryColor
        : Color.Transparent,
      style: BorderStyle.Solid
    })
    // é€‰ä¸­æ€ä¸å†å¢åŠ é¢å¤–é˜´å½±ï¼Œä¿æŒå¹²å‡€
    .shadow({
      radius: 0,
      color: Color.Transparent,
      offsetX: 0,
      offsetY: 0
    })
    // ä½¿ç”¨ renderFit é…åˆ scaleï¼Œè®©ç¼©æ”¾ä¸å½±å“å¸ƒå±€
    .renderFit(RenderFit.CENTER)
    .scale({
      x: this.pressedIndex === index ? 0.95 : (this.selectedIndex === index ? 1.02 : 1.0),
      y: this.pressedIndex === index ? 0.95 : (this.selectedIndex === index ? 1.02 : 1.0)
    })
    .animation({
      duration: 180,
      curve: Curve.FastOutSlowIn
    })
    .visualEffect(new hdsEffect.HdsEffectBuilder()
      .pointLight({
        sourceType: this.isDarkMode ? hdsEffect.PointLightSourceType.NONE :
          (this.activeChipIndex === index
            ? (this.isLightEffectBright ? hdsEffect.PointLightSourceType.BRIGHT : hdsEffect.PointLightSourceType.SOFT)
            : hdsEffect.PointLightSourceType.NONE),
        illuminatedType: this.isDarkMode ? hdsEffect.PointLightIlluminatedType.NONE :
          (this.activeChipIndex !== -1
            ? hdsEffect.PointLightIlluminatedType.BORDER_CONTENT
            : hdsEffect.PointLightIlluminatedType.NONE)
      })
      .buildEffect())
    .onClick(() => {
      this.onSelect(index);
    })
    .onTouch((e: TouchEvent) => {
      if (e.type === TouchType.Down) {
        animateTo({
          duration: 150,
          curve: Curve.EaseOut
        }, () => {
          this.pressedIndex = index;
          this.activeChipIndex = index;
        });
      } else if (e.type === TouchType.Up || e.type === TouchType.Cancel) {
        animateTo({
          duration: 200,
          curve: Curve.EaseIn
        }, () => {
          this.pressedIndex = -1;
          this.activeChipIndex = -1;
        });
      }
    })
  }
}

@Component
struct ConfigCard {
  title: string = '';
  @Prop content: string = '';
  btnId: number = 0;
  isSymbol: boolean = false;
  icon?: Resource;
  @Prop isLightEffectBright: boolean = true;
  @Prop isDarkMode: boolean = true;
  callback: () => void = () => {};
  onInfoClick?: () => void = undefined;
  
  @Link activeBtn: number;
  @State scaleValue: number = 1.0;
  @State bgColor: ResourceColor = '#803c1464';
  @State textColor: ResourceColor = $r('sys.color.font_on_primary');
  @StorageLink('themeColorIndex') @Watch('onThemeColorChange') themeColorIndex: number = 0;

  aboutToAppear() {
    // åˆå§‹åŒ–èƒŒæ™¯è‰²ä¸ºå½“å‰ä¸»é¢˜è‰²
    this.bgColor = THEMES[this.themeColorIndex].secondaryColor;
  }

  onThemeColorChange() {
    if (this.activeBtn === this.btnId) {
      this.bgColor = Color.White;
      this.textColor = THEMES[this.themeColorIndex].primaryColor;
    } else {
      this.bgColor = THEMES[this.themeColorIndex].secondaryColor;
      this.textColor = Color.White;
    }
  }

  build() {
    Stack({ alignContent: Alignment.TopEnd }) {
      if (this.icon) {
        SymbolGlyph(this.icon)
          .fontSize(80)
          .fontColor([this.textColor])
          .opacity(0.1)
          .position({ bottom: -10, left: -10 })
      }

      Column() {
        Text(this.title)
          .fontSize(14)
          .fontColor(this.textColor)
          .opacity(0.7)
          .fontWeight(FontWeight.Medium)
          .alignSelf(ItemAlign.Start)
          .margin({ bottom: 4 })
        
        Blank()

        if (this.isSymbol) {
           SymbolGlyph($r('sys.symbol.face'))
             .fontSize(28)
             .fontColor([this.textColor])
             .fontWeight(FontWeight.Normal)
             .alignSelf(ItemAlign.Start)
        } else {
          Text(this.content)
            .fontSize(20)
            .fontColor(this.textColor)
            .fontWeight(FontWeight.Bold)
            .maxLines(2)
            .textOverflow({ overflow: TextOverflow.Ellipsis })
            .alignSelf(ItemAlign.Start)
        }
      }
      .width('100%')
      .height('100%')
      .padding(16)
      .alignItems(HorizontalAlign.Start)

      if (this.onInfoClick) {
        Button({ type: ButtonType.Circle }) {
          SymbolGlyph($r('sys.symbol.info_circle'))
            .fontSize(20)
            .fontColor([this.textColor])
            .opacity(0.5)
        }
        .backgroundColor(Color.Transparent)
        .width(40)
        .height(40)
        .margin({ top: 4, right: 4 })
        .onClick((event) => {
          if (this.onInfoClick) {
            this.onInfoClick();
          }
        })
      }
    }
    .backgroundColor(this.bgColor)
    .width('100%')
    .height('100%')
    .borderRadius(24)
    .clip(true)
    .scale({ x: this.scaleValue, y: this.scaleValue })
    .onTouch((event: TouchEvent) => {
      this.handleTouch(event);
    })
    .onClick(() => {
      if (this.callback) this.callback();
    })
    .visualEffect(new hdsEffect.HdsEffectBuilder()
      .pointLight({
        sourceType: this.isDarkMode ? hdsEffect.PointLightSourceType.NONE :
          (this.activeBtn === this.btnId
          ? (this.isLightEffectBright ? hdsEffect.PointLightSourceType.BRIGHT : hdsEffect.PointLightSourceType.SOFT)
          : hdsEffect.PointLightSourceType.NONE),
        illuminatedType: this.isDarkMode ? hdsEffect.PointLightIlluminatedType.NONE :
          (this.activeBtn !== 0
          ? hdsEffect.PointLightIlluminatedType.BORDER_CONTENT
          : hdsEffect.PointLightIlluminatedType.NONE)
      })
      .buildEffect())
  }

  handleTouch(event: TouchEvent): void {
    if (event.type === TouchType.Down) {
      this.pressButton();
    } else if (event.type === TouchType.Up || event.type === TouchType.Cancel) {
      this.leaveButton();
    }
  }

  pressButton(): void {
    animateTo({
      duration: 200,
      curve: Curve.FastOutSlowIn
    }, () => {
      this.activeBtn = this.btnId;
      this.scaleValue = 0.95;
      this.bgColor = Color.White;
      this.textColor = THEMES[this.themeColorIndex].primaryColor;
    })
  }

  leaveButton(): void {
    animateTo({
      duration: 200,
      curve: Curve.EaseOut
    }, () => {
      this.activeBtn = 0;
      this.scaleValue = 1.0;
      this.bgColor = THEMES[this.themeColorIndex].secondaryColor;
      this.textColor = Color.White;
    })
  }
}

@Component
export struct ConfigurationPage {
  // Props
  apiOptions: string[] = [];
  @Prop selectedApiIndex: number = 0;
  @Prop currentModelName: string = '';
  languageOptions: string[] = [];
  languageDisplayOptions: string[] = [];
  @Prop selectedLanguageIndex: number = 0;
  intervalOptions: string[] = [];
  @Prop selectedIntervalIndex: number = 0;
  contextsOptions: string[] = [];
  @Prop selectedContextsIndex: number = 0;
  temperatureOptions: string[] = [];
  @Prop selectedTemperatureIndex: number = 0;
  maxTokensOptions: string[] = [];
  @Prop selectedMaxTokensIndex: number = 0;
  vadSensitivityOptions: string[] = [];
  @Prop selectedVadSensitivityIndex: number = 0;
  minMatchLenOptions: string[] = [];
  @Prop selectedMinMatchLenIndex: number = 0;
  @Prop @Watch('onVisibleChange') isVisible: boolean = false;
  @Prop isLightEffectBright: boolean = true;
  @Prop isDarkMode: boolean = true;
  @StorageLink('themeColorIndex') @Watch('onThemeColorChange') themeColorIndex: number = 0;

  // Callbacks
  onCycleApi: () => void = () => {};
  onCycleLanguage: () => void = () => {};
  onOpenApiSettings: () => void = () => {};
  onSelectInterval: (index: number) => void = () => {};
  onSelectContexts: (index: number) => void = () => {};
  onSelectTemperature: (index: number) => void = () => {};
  onSelectMaxTokens: (index: number) => void = () => {};
  onSelectVadSensitivity: (index: number) => void = () => {};
  onSelectMinMatchLen: (index: number) => void = () => {};

  @State activeBtn: number = 0;

  // åº•éƒ¨é€‰æ‹©å™¨çŠ¶æ€
  @State isOptionSheetVisible: boolean = false;
  @State sheetTitle: string = '';
  @State sheetDescription: string = '';
  @State sheetOptions: string[] = [];
  @State sheetSelectedIndex: number = 0;
  // ä½¿ç”¨æšä¸¾ç±»å‹ä»£æ›¿å‡½æ•°å¼•ç”¨ï¼Œé¿å… @State ä¸æ”¯æŒå‡½æ•°çš„é—®é¢˜
  @State sheetType: string = ''; // 'interval' | 'contexts' | 'temperature' | 'maxTokens' | 'vad' | 'minMatch'

  // Animation states
  @State cardScales: number[] = [0.9, 0.9, 0.9, 0.9, 0.9, 0.9, 0.9, 0.9, 0.9, 0.9, 0.9, 0.9];
  @State cardOpacities: number[] = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];

  // New states for disclaimer card
  @State disclaimerScale: number = 1.0;
  @State disclaimerBgColor: ResourceColor = '#803c1464';
  @State disclaimerTextColor: ResourceColor = Color.White;
  @State disclaimerSubTextColor: ResourceColor = $r('sys.color.font_tertiary');
  
  // API ä»‹ç»å±•å¼€çŠ¶æ€
  @State isApiIntroExpanded: boolean = false;
  @State disclaimerWidth: string = 'calc(100% - 48vp)';
  @State disclaimerHeight: number = 120;
  @State disclaimerBorderRadius: number = 30;
  @State expandedContentOpacity: number = 0;
  @State collapsedContentOpacity: number = 1;
  private longPressTimer: number | undefined = undefined;

  private animationTimeouts: number[] = [];

  aboutToAppear() {
    // åˆå§‹åŒ–disclaimerèƒŒæ™¯è‰²ä¸ºå½“å‰ä¸»é¢˜è‰²
    this.disclaimerBgColor = THEMES[this.themeColorIndex].secondaryColor;
    this.disclaimerSubTextColor = THEMES[this.themeColorIndex].primaryColor.replace('#', '#CC');
    if (this.isVisible) {
      this.playAnimations();
    }
  }

  aboutToDisappear() {
    this.clearAnimationTimeouts();
  }

  onVisibleChange() {
    if (this.isVisible) {
      this.resetAnimations();
      this.playAnimations();
    } else {
      this.clearAnimationTimeouts();
    }
  }

  resetAnimations() {
    this.clearAnimationTimeouts();
    for (let i = 0; i < 12; i++) {
      this.cardScales[i] = 0.8;
      this.cardOpacities[i] = 0;
    }
  }

  playAnimations() {
    for (let i = 0; i < 12; i++) {
      let id = setTimeout(() => {
        animateTo({
          duration: 300,
          curve: Curve.FastOutSlowIn
        }, () => {
          this.cardScales[i] = 1.0;
          this.cardOpacities[i] = 1.0;
        })
      }, i * 50);
      this.animationTimeouts.push(id);
    }
  }

  clearAnimationTimeouts() {
    this.animationTimeouts.forEach(id => clearTimeout(id));
    this.animationTimeouts = [];
  }

  onThemeColorChange() {
    if (this.activeBtn === 99) {
      this.disclaimerBgColor = Color.White;
      this.disclaimerTextColor = THEMES[this.themeColorIndex].primaryColor;
      this.disclaimerSubTextColor = THEMES[this.themeColorIndex].primaryColor;
    } else {
      this.disclaimerBgColor = THEMES[this.themeColorIndex].secondaryColor;
      this.disclaimerTextColor = Color.White;
      this.disclaimerSubTextColor = THEMES[this.themeColorIndex].primaryColor.replace('#', '#CC');
    }
  }

  private getLanguageLabels(): string[] {
    if (this.languageDisplayOptions.length > 0) {
      return this.languageDisplayOptions;
    }
    return this.languageOptions;
  }

  private openOptionSheet(title: string, description: string, options: string[], selected: number, type: string): void {
    this.sheetTitle = title;
    this.sheetDescription = description;
    this.sheetOptions = options;
    this.sheetSelectedIndex = selected;
    this.sheetType = type;
    this.isOptionSheetVisible = true;
  }

  private handleSheetSelect(index: number): void {
    switch (this.sheetType) {
      case 'interval':
        this.onSelectInterval(index);
        break;
      case 'contexts':
        this.onSelectContexts(index);
        break;
      case 'temperature':
        this.onSelectTemperature(index);
        break;
      case 'maxTokens':
        this.onSelectMaxTokens(index);
        break;
      case 'vad':
        this.onSelectVadSensitivity(index);
        break;
      case 'minMatch':
        this.onSelectMinMatchLen(index);
        break;
    }
  }

  pressDisclaimer(): void {
    animateTo({ duration: 100, curve: Curve.EaseIn }, () => {
      this.disclaimerScale = 0.95;
      this.disclaimerBgColor = Color.White;
      this.disclaimerTextColor = THEMES[this.themeColorIndex].primaryColor;
      this.disclaimerSubTextColor = THEMES[this.themeColorIndex].primaryColor;
    });
    
    // å¼€å§‹é•¿æŒ‰è®¡æ—¶å™¨
    this.longPressTimer = setTimeout(() => {
      this.showApiIntro();
    }, 600); // 600ms è§¦å‘é•¿æŒ‰
  }

  releaseDisclaimer(): void {
    // æ¸…é™¤é•¿æŒ‰è®¡æ—¶å™¨
    if (this.longPressTimer !== undefined) {
      clearTimeout(this.longPressTimer);
      this.longPressTimer = undefined;
    }
    
    animateTo({ duration: 100, curve: Curve.EaseOut }, () => {
      this.disclaimerScale = 1.0;
      this.disclaimerBgColor = THEMES[this.themeColorIndex].secondaryColor;
      this.disclaimerTextColor = Color.White;
      this.disclaimerSubTextColor = THEMES[this.themeColorIndex].primaryColor.replace('#', '#CC');
    });
  }
  
  showApiIntro(): void {
    // æ ‡è®°å±•å¼€çŠ¶æ€
    this.isApiIntroExpanded = true;
    this.activeBtn = 0; // å…³é—­å…‰æ•ˆ
    
    // æ·¡å‡ºç®€çŸ­å†…å®¹
    animateTo({
      duration: 150,
      curve: Curve.EaseOut
    }, () => {
      this.collapsedContentOpacity = 0;
      this.disclaimerScale = 1.0;
      this.disclaimerBgColor = THEMES[this.themeColorIndex].secondaryColor;
      this.disclaimerTextColor = Color.White;
      this.disclaimerSubTextColor = THEMES[this.themeColorIndex].primaryColor.replace('#', '#CC');
    });
    
    // å±•å¼€å¡ç‰‡
    setTimeout(() => {
      animateTo({
        duration: 400,
        curve: Curve.FastOutSlowIn
      }, () => {
        this.disclaimerWidth = 'calc(100% - 48vp)';
        this.disclaimerHeight = 400; // è°ƒæ•´é«˜åº¦ä»¥å‡å°‘ç•™ç™½
        this.disclaimerBorderRadius = 32;
      });
    }, 100);
    
    // æ·¡å…¥è¯¦ç»†å†…å®¹
    setTimeout(() => {
      animateTo({
        duration: 300,
        curve: Curve.EaseOut
      }, () => {
        this.expandedContentOpacity = 1;
      });
    }, 350);
  }
  
  hideApiIntro(): void {
    // æ·¡å‡ºè¯¦ç»†å†…å®¹
    animateTo({
      duration: 200,
      curve: Curve.EaseIn
    }, () => {
      this.expandedContentOpacity = 0;
    });
    
    // æ”¶ç¼©å¡ç‰‡
    setTimeout(() => {
      animateTo({
        duration: 350,
        curve: Curve.FastOutSlowIn
      }, () => {
        this.disclaimerWidth = 'calc(100% - 48vp)';
        this.disclaimerHeight = 120;
        this.disclaimerBorderRadius = 30;
        this.disclaimerBgColor = THEMES[this.themeColorIndex].secondaryColor;
        this.disclaimerTextColor = Color.White;
        this.disclaimerSubTextColor = THEMES[this.themeColorIndex].primaryColor.replace('#', '#CC');
      });
    }, 150);
    
    // æ·¡å…¥ç®€çŸ­å†…å®¹
    setTimeout(() => {
      animateTo({
        duration: 250,
        curve: Curve.EaseOut
      }, () => {
        this.collapsedContentOpacity = 1;
      });
      this.isApiIntroExpanded = false;
    }, 400);
  }

  handleConfigApi(): void {
    let facestatus = AuthUtil.getAvailableStatus(userIAM_userAuth.UserAuthType.FACE, userIAM_userAuth.AuthTrustLevel.ATL1)
    let fingerstatus = AuthUtil.getAvailableStatus(userIAM_userAuth.UserAuthType.FINGERPRINT, userIAM_userAuth.AuthTrustLevel.ATL2)
    let pinstatus = AuthUtil.getAvailableStatus(userIAM_userAuth.UserAuthType.PIN, userIAM_userAuth.AuthTrustLevel.ATL2)
    if (facestatus.status) {
      AuthUtil.onStart({
        authType: [userAuth.UserAuthType.FACE],
        authTrustLevel: userAuth.AuthTrustLevel.ATL3,
        title: 'è¯·éªŒè¯äººè„¸',
        showTip: true
      }, (result: userAuth.UserAuthResult) => {
        const authPassed: boolean = !!result && result.result === AUTH_SUCCESS_CODE;
        if (authPassed) {
          this.onOpenApiSettings();
          return;
        }
        ToastUtil.showToast('Voot æ— æ³•éªŒè¯æ‚¨çš„å±å¹•é”å®šé€‰é¡¹ï¼Œè¯·é‡è¯• ğŸ¤§')})
    } else if (!facestatus.status && fingerstatus.status) {
      AuthUtil.onStartEasy(true, (result: userAuth.UserAuthResult) => {
        const authPassed: boolean = !!result && result.result === AUTH_SUCCESS_CODE;
        if (authPassed) {
          this.onOpenApiSettings();
          return;
        }
        ToastUtil.showToast('Voot æ— æ³•éªŒè¯æ‚¨çš„å±å¹•é”å®šé€‰é¡¹ï¼Œè¯·é‡è¯• ğŸ¤§')})
    } else if (!facestatus.status && !fingerstatus.status && pinstatus.status) {
      AuthUtil.onStartEasy(true, (result: userAuth.UserAuthResult) => {
        const authPassed: boolean = !!result && result.result === AUTH_SUCCESS_CODE;
        if (authPassed) {
          this.onOpenApiSettings();
          return;
        }
        ToastUtil.showToast('Voot æ— æ³•éªŒè¯æ‚¨çš„å±å¹•é”å®šé€‰é¡¹ï¼Œè¯·é‡è¯• ğŸ¤§')})
    } else {
      this.onOpenApiSettings()
      ToastUtil.showToast('æ‚¨ä¼¼ä¹æ²¡æœ‰å±å¹•é”å®šé€‰é¡¹ï¼Œå¯†é’¥ä¸å—ä¿éšœ ğŸ˜')}
  }

  build() {
    Stack() {
      HdsNavigation() {
        Scroll() {
          Column() {
            Blank().height(TITLE_BAR_HEIGHT_MINI);

            Column() {
              // æ”¶èµ·çŠ¶æ€çš„å†…å®¹
              if (!this.isApiIntroExpanded) {
                Column() {
                  SymbolGlyph($r('sys.symbol.exclamationmark_shield_fill'))
                    .fontSize(24)
                    .fontColor([this.disclaimerTextColor])
                    .margin({ bottom: 8 })
                  Text('Voot ä¸æä¾›æˆ–è½¬å”®ä»»ä½• API å¯†é’¥')
                    .fontSize(16)
                    .fontColor(this.disclaimerTextColor)
                    .fontWeight(FontWeight.Medium)
                    .margin({ bottom: 4 })
                    .textAlign(TextAlign.Center)
                  Text('é•¿æŒ‰äº†è§£')
                    .fontSize(12)
                    .fontColor(this.disclaimerTextColor)
                    .margin({ top: 4 })
                }
                .opacity(this.collapsedContentOpacity)
              }
              
              // å±•å¼€çŠ¶æ€çš„å†…å®¹
              if (this.isApiIntroExpanded) {
                Scroll() {
                  Column() {
                    // é¡¶éƒ¨å…³é—­æŒ‰é’®
                    Row() {
                      SymbolGlyph($r('sys.symbol.exclamationmark_shield_fill'))
                        .fontSize(24)
                        .fontColor([Color.White])
                      Text('å…³äº API å¯†é’¥')
                        .fontSize(20)
                        .fontColor(Color.White)
                        .fontWeight(FontWeight.Bold)
                        .margin({ left: 12 })
                      Blank()
                      Button({ type: ButtonType.Circle }) {
                        SymbolGlyph($r('sys.symbol.arrow_up'))
                          .fontSize(16)
                          .fontColor([Color.White])
                      }
                      .width(32)
                      .height(32)
                      .backgroundColor('#33FFFFFF')
                      .onClick(() => {
                        this.hideApiIntro();
                      })
                    }
                    .width('100%')
                    .padding({ left: 4, right: 4, bottom: 24 })
                    
                    // API ä»‹ç»å†…å®¹
                    Column({ space: 24 }) {
                      // ä»€ä¹ˆæ˜¯ API å¯†é’¥
                      Row({ space: 16 }) {
                        SymbolGlyph($r('sys.symbol.key'))
                          .fontSize(24)
                          .fontColor(['#EEFFFFFF'])
                          .margin({ top: 2 })
                        Column({ space: 4 }) {
                          Text('ä»€ä¹ˆæ˜¯ API å¯†é’¥ï¼Ÿ')
                            .fontSize(16)
                            .fontColor(Color.White)
                            .fontWeight(FontWeight.Medium)
                          Text('API å¯†é’¥æ˜¯æ‚¨è®¿é—®å¤§æ¨¡å‹æœåŠ¡çš„å‡­è¯ã€‚Voot ä½¿ç”¨æ­¤å¯†é’¥ç›´æ¥ä¸æœåŠ¡å•†ï¼ˆå¦‚ OpenAIã€è±†åŒ…ï¼‰é€šä¿¡ã€‚')
                            .fontSize(14)
                            .fontColor('#CCFFFFFF')
                            .lineHeight(20)
                        }
                        .layoutWeight(1)
                        .alignItems(HorizontalAlign.Start)
                      }
                      .width('100%')
                      .alignItems(VerticalAlign.Top)

                      // å®‰å…¨æ‰¿è¯º
                      Row({ space: 16 }) {
                        SymbolGlyph($r('sys.symbol.lock_shield'))
                          .fontSize(24)
                          .fontColor(['#EEFFFFFF'])
                          .margin({ top: 2 })
                        Column({ space: 4 }) {
                          Text('å®‰å…¨æ‰¿è¯º')
                            .fontSize(16)
                            .fontColor(Color.White)
                            .fontWeight(FontWeight.Medium)
                          Text('æ‚¨çš„å¯†é’¥ä»…åŠ å¯†å­˜å‚¨åœ¨æœ¬åœ°è®¾å¤‡ä¸Šï¼Œå—ç³»ç»Ÿå®‰å…¨èŠ¯ç‰‡ä¿æŠ¤ã€‚Voot ä¸ä¼šä¸Šä¼ ã€æ”¶é›†æˆ–ä¸ç¬¬ä¸‰æ–¹å…±äº«æ‚¨çš„å¯†é’¥ã€‚')
                            .fontSize(14)
                            .fontColor('#CCFFFFFF')
                            .lineHeight(20)
                        }
                        .layoutWeight(1)
                        .alignItems(HorizontalAlign.Start)
                      }
                      .width('100%')
                      .alignItems(VerticalAlign.Top)

                      // ç›´è¿æœåŠ¡
                      Row({ space: 16 }) {
                        SymbolGlyph($r('sys.symbol.link'))
                          .fontSize(24)
                          .fontColor(['#EEFFFFFF'])
                          .margin({ top: 2 })
                        Column({ space: 4 }) {
                          Text('ç›´è¿æœåŠ¡')
                            .fontSize(16)
                            .fontColor(Color.White)
                            .fontWeight(FontWeight.Medium)
                          Text('æ‰€æœ‰è¯·æ±‚å‡ç”±æ‚¨çš„è®¾å¤‡ç›´æ¥å‘é€è‡³æœåŠ¡å•†ï¼Œä¸ç»è¿‡ä»»ä½•ä¸­é—´æœåŠ¡å™¨ï¼Œç¡®ä¿éšç§å®‰å…¨ã€‚')
                            .fontSize(14)
                            .fontColor('#CCFFFFFF')
                            .lineHeight(20)
                        }
                        .layoutWeight(1)
                        .alignItems(HorizontalAlign.Start)
                      }
                      .width('100%')
                      .alignItems(VerticalAlign.Top)
                    }
                    .width('100%')
                    .padding({ left: 4, right: 4 })
                  }
                  .width('100%')
                }
                .scrollBar(BarState.Off)
                .width('100%')
                .layoutWeight(1)
                .opacity(this.expandedContentOpacity)
                .nestedScroll({
                  scrollForward: NestedScrollMode.SELF_FIRST,
                  scrollBackward: NestedScrollMode.SELF_FIRST
                })
              }
            }
            .width(this.disclaimerWidth)
            .height(this.disclaimerHeight)
            .padding(20)
          .margin({ bottom: 10 })
          .backgroundColor(this.disclaimerBgColor)
          .borderRadius(this.disclaimerBorderRadius)
          .alignItems(HorizontalAlign.Center)
          .justifyContent(this.isApiIntroExpanded ? FlexAlign.Start : FlexAlign.Center)
          .opacity(this.cardOpacities[0])
          .scale({ x: this.disclaimerScale * this.cardScales[0], y: this.disclaimerScale * this.cardScales[0] })
          .zIndex(this.isApiIntroExpanded ? 100 : 0)
          .shadow(this.isApiIntroExpanded ? {
            radius: 32,
            color: '#40000000',
            offsetX: 0,
            offsetY: 8
          } : {
            radius: 0,
            color: 'transparent',
            offsetX: 0,
            offsetY: 0
          })
          .visualEffect(new hdsEffect.HdsEffectBuilder()
            .pointLight({
              sourceType: this.activeBtn === 99 ? (this.isLightEffectBright ? hdsEffect.PointLightSourceType.BRIGHT : hdsEffect.PointLightSourceType.SOFT) : hdsEffect.PointLightSourceType.NONE,
              illuminatedType: this.activeBtn !== 0 ? hdsEffect.PointLightIlluminatedType.BORDER_CONTENT : hdsEffect.PointLightIlluminatedType.NONE
            })
            .buildEffect())
          .onTouch((event: TouchEvent) => {
            if (this.isApiIntroExpanded) {
              return; // å±•å¼€çŠ¶æ€ä¸‹ä¸å“åº”è§¦æ‘¸
            }
            if (event.type === TouchType.Down) {
              this.pressDisclaimer();
              this.activeBtn = 99;
            } else if (event.type === TouchType.Up || event.type === TouchType.Cancel) {
              this.releaseDisclaimer();
              this.activeBtn = 0;
            }
          })

          TokenUsageChart({
            modelName: this.currentModelName || this.apiOptions[this.selectedApiIndex],
            activeBtn: $activeBtn,
            isLightEffectBright: this.isLightEffectBright
          })
          .opacity(this.cardOpacities[1])
          .scale({ x: this.cardScales[1], y: this.cardScales[1] })

          Grid() {
            GridItem() {
              ConfigCard({
                title: 'é€‰æ‹© API',
                content: this.apiOptions[this.selectedApiIndex],
                btnId: 1,
                icon: $r('sys.symbol.more'),
                isLightEffectBright: this.isLightEffectBright,
                isDarkMode: this.isDarkMode,
                callback: () => this.onCycleApi(),
                activeBtn: $activeBtn,
                onInfoClick: () => {
                  AlertDialog.show({
                    title: 'é€‰æ‹© API è¯´æ˜',
                    message: 'ç‚¹å‡»åˆ‡æ¢å¯ç”¨çš„ç¿»è¯‘ / LLM æœåŠ¡ï¼šOpenAIã€DeepLã€Ollamaã€Doubaoã€‚é€‰æ‹©åè¯·åœ¨â€œé…ç½®APIâ€é‡Œå¡«å†™å¯¹åº”åœ°å€ã€ï¼ˆæ¨¡å‹ï¼‰å’Œå¯†é’¥ã€‚\nDoubao å¹¶éä»…é™äºâ€œè±†åŒ…â€ï¼Œæ”¯æŒå¹¿ä¹‰HTTPè¯·æ±‚å¤§æ¨¡å‹ã€‚',
                    confirm: {
                      value: 'æˆ‘çŸ¥é“äº†',
                      fontColor: THEMES[this.themeColorIndex].primaryColor,
                      action: () => {}
                    }
                  })
                }
              })
            }
            .opacity(this.cardOpacities[2])
            .scale({ x: this.cardScales[2], y: this.cardScales[2] })

            GridItem() {
              ConfigCard({
                title: 'é…ç½® API',
                content: '',
                btnId: 2,
                icon: $r('sys.symbol.gearshape'),
                isLightEffectBright: this.isLightEffectBright,
                isDarkMode: this.isDarkMode,
                callback: () => this.handleConfigApi(),
                isSymbol: true,
                activeBtn: $activeBtn,
                onInfoClick: () => {
                  AlertDialog.show({
                    title: 'é…ç½® API è¯´æ˜',
                    message: 'ä½¿ç”¨æ‚¨çš„å±å¹•é”å®šä¿¡æ¯ä¿æŠ¤æ‚¨çš„å¯†é’¥ä¸é…ç½®ã€‚',
                    confirm: {
                      value: 'æˆ‘çŸ¥é“äº†',
                      fontColor: THEMES[this.themeColorIndex].primaryColor,
                      action: () => {}
                    }
                  })
                }
              })
            }
            .opacity(this.cardOpacities[3])
            .scale({ x: this.cardScales[3], y: this.cardScales[3] })

            GridItem() {
              ConfigCard({
                title: 'åŸå§‹è¯­è¨€',
                content: 'è‹±è¯­',
                btnId: 3,
                icon: $r('sys.symbol.mic'),
                isLightEffectBright: this.isLightEffectBright,
                isDarkMode: this.isDarkMode,
                callback: () => {
                  // ToastUtil.showToast('å½“å‰ä»…æ”¯æŒè‹±è¯­ä½œä¸ºåŸå§‹è¯­è¨€');
                },
                activeBtn: $activeBtn,
                onInfoClick: () => {
                  AlertDialog.show({
                    title: 'åŸå§‹è¯­è¨€è¯´æ˜',
                    message: 'ç¿»è¯‘åŠŸèƒ½çš„åŸå§‹è¯­è¨€ï¼Œæš‚æ—¶ä»…æ”¯æŒè‹±è¯­ã€‚',
                    confirm: {
                      value: 'æˆ‘çŸ¥é“äº†',
                      fontColor: THEMES[this.themeColorIndex].primaryColor,
                      action: () => {}
                    }
                  })
                }
              })
            }
            .opacity(this.cardOpacities[4])
            .scale({ x: this.cardScales[4], y: this.cardScales[4] })

            GridItem() {
              ConfigCard({
                title: 'ç›®æ ‡è¯­è¨€',
                content: this.getLanguageLabels()[this.selectedLanguageIndex],
                btnId: 4,
                icon: $r('sys.symbol.translate_e2c'),
                isLightEffectBright: this.isLightEffectBright,
                isDarkMode: this.isDarkMode,
                callback: () => this.onCycleLanguage(),
                activeBtn: $activeBtn,
                onInfoClick: () => {
                  AlertDialog.show({
                    title: 'ç›®æ ‡è¯­è¨€è¯´æ˜',
                    message: 'ç¿»è¯‘ã€æ‰«æç»“æœå°†è¾“å‡ºä¸ºç›®æ ‡è¯­è¨€ï¼Œç‚¹å‡»åˆ‡æ¢ä¸‹ä¸€ä¸ªè¯­è¨€ã€‚',
                    confirm: {
                      value: 'æˆ‘çŸ¥é“äº†',
                      fontColor: THEMES[this.themeColorIndex].primaryColor,
                      action: () => {}
                    }
                  })
                }
              })
            }
            .opacity(this.cardOpacities[5])
            .scale({ x: this.cardScales[5], y: this.cardScales[5] })

            GridItem() {
              ConfigCard({
                title: 'é—´éš”',
                content: this.intervalOptions[this.selectedIntervalIndex] + ' ç§’',
                btnId: 5,
                icon: $r('sys.symbol.clock'),
                isLightEffectBright: this.isLightEffectBright,
                isDarkMode: this.isDarkMode,
                callback: () => this.openOptionSheet(
                  'ç¿»è¯‘é—´éš”',
                  'è®¾ç½®ä¸¤æ¬¡ç¿»è¯‘è¯·æ±‚ä¹‹é—´çš„æœ€å°æ—¶é—´é—´éš”',
                  this.intervalOptions.map(v => v + ' ç§’'),
                  this.selectedIntervalIndex,
                  'interval'
                ),
                activeBtn: $activeBtn,
                onInfoClick: () => {
                  AlertDialog.show({
                    title: 'é—´éš”è¯´æ˜',
                    message: 'è®¾ç½®ä¸¤æ¬¡ç¿»è¯‘è¯·æ±‚ä¹‹é—´çš„æœ€å°æ—¶é—´é—´éš”ï¼ˆç§’ï¼‰ï¼ŒåŒæ—¶ä¹Ÿä½œä¸ºä¼ è¯‘çš„æ—¶é—´é—´éš”ã€‚\nè¾ƒçŸ­çš„é—´éš”èƒ½æä¾›æ›´å®æ—¶çš„åé¦ˆï¼Œä½†ä¼šæ¶ˆè€—æ›´å¤š Tokenã€‚\né»˜è®¤é—´éš”æ¨èä¸º5ã€‚',
                    confirm: {
                      value: 'æˆ‘çŸ¥é“äº†',
                      fontColor: THEMES[this.themeColorIndex].primaryColor,
                      action: () => {}
                    }
                  })
                }
              })
            }
            .opacity(this.cardOpacities[6])
            .scale({ x: this.cardScales[6], y: this.cardScales[6] })

            GridItem() {
              ConfigCard({
                title: 'ä¸Šä¸‹æ–‡',
                content: this.contextsOptions[this.selectedContextsIndex] + ' è½®',
                btnId: 6,
                icon: $r('sys.symbol.paperclip'),
                isLightEffectBright: this.isLightEffectBright,
                isDarkMode: this.isDarkMode,
                callback: () => this.openOptionSheet(
                  'å†å²ä¸Šä¸‹æ–‡',
                  'ç”¨äºç¿»è¯‘åŠŸèƒ½ã€‚æ›´å¤šä¸Šä¸‹æ–‡æœ‰åŠ©äºæ¨¡å‹ç†è§£è¯­å¢ƒï¼Œä½†ä¼šæ¶ˆè€—æ›´å¤š Token',
                  this.contextsOptions.map(v => v + ' è½®'),
                  this.selectedContextsIndex,
                  'contexts'
                ),
                activeBtn: $activeBtn,
                onInfoClick: () => {
                  AlertDialog.show({
                    title: 'ä¸Šä¸‹æ–‡è¯´æ˜',
                    message: 'é€‚ç”¨äºç¿»è¯‘åŠŸèƒ½ã€‚è®¾ç½®å‘é€ç»™ç¿»è¯‘æ¨¡å‹çš„å†å²å¯¹è¯è½®æ•°ã€‚\næ›´å¤šçš„ä¸Šä¸‹æ–‡æœ‰åŠ©äºæ¨¡å‹ç†è§£è¯­å¢ƒï¼Œæé«˜ç¿»è¯‘å‡†ç¡®åº¦ï¼Œä½†ä¼šæ¶ˆè€—æ›´å¤š Tokenã€‚\né»˜è®¤ä¸Šä¸‹æ–‡æ¨èä¸º3ã€‚',
                    confirm: {
                      value: 'æˆ‘çŸ¥é“äº†',
                      fontColor: THEMES[this.themeColorIndex].primaryColor,
                      action: () => {}
                    }
                  })
                }
              })
            }
            .opacity(this.cardOpacities[7])
            .scale({ x: this.cardScales[7], y: this.cardScales[7] })

            GridItem() {
              ConfigCard({
                title: 'æ¸©åº¦',
                content: this.temperatureOptions[this.selectedTemperatureIndex],
                btnId: 7,
                icon: $r('sys.symbol.slider_horizontal_2'),
                isLightEffectBright: this.isLightEffectBright,
                isDarkMode: this.isDarkMode,
                callback: () => this.openOptionSheet(
                  'æ¨¡å‹æ¸©åº¦',
                  'è¾ƒä½æ›´ç¡®å®šï¼Œè¾ƒé«˜æ›´éšæœº',
                  this.temperatureOptions,
                  this.selectedTemperatureIndex,
                  'temperature'
                ),
                activeBtn: $activeBtn,
                onInfoClick: () => {
                  AlertDialog.show({
                    title: 'æ¸©åº¦è¯´æ˜',
                    message: 'é€‚ç”¨äºç¿»è¯‘ã€æ¶¦è‰²å’Œæ‰«æã€‚æ§åˆ¶æ¨¡å‹è¾“å‡ºçš„éšæœºæ€§ã€‚\nè¾ƒä½çš„å€¼ä½¿è¾“å‡ºæ›´é›†ä¸­å’Œç¡®å®šã€‚è¾ƒé«˜çš„å€¼ä½¿è¾“å‡ºæ›´éšæœºå’Œå¤šæ ·ã€‚\né»˜è®¤æ¸©åº¦æ¨èä¸º0.3ï¼Œä¸”ä¸å»ºè®®è¿‡å¤§ã€‚',
                    confirm: {
                      value: 'æˆ‘çŸ¥é“äº†',
                      fontColor: THEMES[this.themeColorIndex].primaryColor,
                      action: () => {}
                    }
                  })
                }
              })
            }
            .opacity(this.cardOpacities[8])
            .scale({ x: this.cardScales[8], y: this.cardScales[8] })

            GridItem() {
              ConfigCard({
                title: 'æœ€å¤§ Token',
                content: this.maxTokensOptions[this.selectedMaxTokensIndex],
                btnId: 8,
                icon: $r('sys.symbol.puzzle_fill'),
                isLightEffectBright: this.isLightEffectBright,
                isDarkMode: this.isDarkMode,
                callback: () => this.openOptionSheet(
                  'æœ€å¤§ Token',
                  'å•æ¬¡å›å¤çš„æœ€å¤§é•¿åº¦',
                  this.maxTokensOptions.map(v => v),
                  this.selectedMaxTokensIndex,
                  'maxTokens'
                ),
                activeBtn: $activeBtn,
                onInfoClick: () => {
                  AlertDialog.show({
                    title: 'æœ€å¤§ Token è¯´æ˜',
                    message: 'é€‚ç”¨äºç¿»è¯‘ã€æ¶¦è‰²å’Œæ‰«æã€‚è®¾ç½®æ¨¡å‹å•æ¬¡å›å¤ç”Ÿæˆçš„æœ€å¤§ Token æ•°é‡ã€‚\nè¾ƒå°çš„å€¼é€‚åˆç®€çŸ­å›å¤ï¼Œå“åº”æ›´å¿«ã€‚è¾ƒå¤§çš„å€¼å…è®¸æ›´é•¿çš„å›å¤ï¼Œä½†å¯èƒ½å¢åŠ å»¶è¿Ÿã€‚\né»˜è®¤æœ€å¤§ Token æ¨èä¸º256ã€‚',
                    confirm: {
                      value: 'æˆ‘çŸ¥é“äº†',
                      fontColor: THEMES[this.themeColorIndex].primaryColor,
                      action: () => {}
                    }
                  })
                }
              })
            }
            .opacity(this.cardOpacities[9])
            .scale({ x: this.cardScales[9], y: this.cardScales[9] })

            GridItem() {
              ConfigCard({
                title: 'VAD çµæ•åº¦',
                content: this.vadSensitivityOptions[this.selectedVadSensitivityIndex],
                btnId: 9,
                icon: $r('sys.symbol.magnetic_sensor'),
                isLightEffectBright: this.isLightEffectBright,
                isDarkMode: this.isDarkMode,
                callback: () => this.openOptionSheet(
                  'VAD çµæ•åº¦',
                  'è¾ƒé«˜æ›´æ•æ„Ÿä½†å¯èƒ½è¯¯æŠ¥å™ªéŸ³',
                  this.vadSensitivityOptions,
                  this.selectedVadSensitivityIndex,
                  'vad'
                ),
                activeBtn: $activeBtn,
                onInfoClick: () => {
                  AlertDialog.show({
                    title: 'VAD çµæ•åº¦è¯´æ˜',
                    message: 'é€‚ç”¨äºç¿»è¯‘åŠŸèƒ½ã€‚è®¾ç½®è¯­éŸ³æ´»åŠ¨æ£€æµ‹çš„çµæ•åº¦ã€‚\nè¾ƒé«˜çš„çµæ•åº¦æ›´å®¹æ˜“æ£€æµ‹åˆ°è¯­éŸ³ï¼Œä½†ä¹Ÿå¯èƒ½è¯¯æŠ¥å™ªéŸ³ã€‚\né»˜è®¤ VAD çµæ•åº¦æ¨èä¸ºä¸­ã€‚',
                    confirm: {
                      value: 'æˆ‘çŸ¥é“äº†',
                      fontColor: THEMES[this.themeColorIndex].primaryColor,
                      action: () => {}
                    }
                  })
                }
              })
            }
            .opacity(this.cardOpacities[10])
            .scale({ x: this.cardScales[10], y: this.cardScales[10] })

            GridItem() {
              ConfigCard({
                title: 'æœ€å°åŒ¹é…é•¿åº¦',
                content: this.minMatchLenOptions[this.selectedMinMatchLenIndex] + ' å­—ç¬¦',
                btnId: 10,
                icon: $r('sys.symbol.text_alignleft'),
                isLightEffectBright: this.isLightEffectBright,
                isDarkMode: this.isDarkMode,
                callback: () => this.openOptionSheet(
                  'æœ€å°åŒ¹é…é•¿åº¦',
                  'æ™ºèƒ½æ‹¼æ¥æ–‡æœ¬æ—¶çš„æœ€å°é‡å å­—ç¬¦æ•°',
                  this.minMatchLenOptions.map(v => v + ' å­—ç¬¦'),
                  this.selectedMinMatchLenIndex,
                  'minMatch'
                ),
                activeBtn: $activeBtn,
                onInfoClick: () => {
                  AlertDialog.show({
                    title: 'æœ€å°åŒ¹é…é•¿åº¦è¯´æ˜',
                    message: 'é€‚ç”¨äºç¿»è¯‘åŠŸèƒ½ã€‚è®¾ç½®æ™ºèƒ½æ‹¼æ¥æ–‡æœ¬æ—¶çš„æœ€å°é‡å å­—ç¬¦æ•°ã€‚\nè¾ƒå¤§çš„å€¼èƒ½å‡å°‘è¯¯æ‹¼æ¥ï¼Œä½†å¯èƒ½å¯¼è‡´é‡å¤ã€‚\né»˜è®¤æœ€å°åŒ¹é…é•¿åº¦æ¨èä¸º5ã€‚',
                    confirm: {
                      value: 'æˆ‘çŸ¥é“äº†',
                      fontColor: THEMES[this.themeColorIndex].primaryColor,
                      action: () => {}
                    }
                  })
                }
              })
            }
            .opacity(this.cardOpacities[11])
            .scale({ x: this.cardScales[11], y: this.cardScales[11] })
          }
          .columnsTemplate('1fr 1fr')
          .rowsTemplate('1fr 1fr 1fr 1fr 1fr')
          .columnsGap(10)
          .rowsGap(10)
          .padding({ left: 24, right: 24 })
          .height(560)
        }
        .width('100%')
        .padding({ bottom: 100 })
      }
      .scrollable(ScrollDirection.Vertical)
      .scrollBar(BarState.Off)
      .edgeEffect(EdgeEffect.Spring)
    }
    .mode(NavigationMode.Stack)
    .width('100%')
    .height('100%')
    .backgroundColor(Color.Transparent)
    .titleMode(HdsNavigationTitleMode.MINI)
    .hideBackButton(true)
    .bindSheet($$this.isOptionSheetVisible, this.OptionSheetBuilder(), {
      height: SheetSize.FIT_CONTENT,
      backgroundColor: Color.Transparent,
      blurStyle: BlurStyle.NONE,
      showClose: false,
      dragBar: false,
      onDisappear: () => {
        this.isOptionSheetVisible = false;
      }
    })
    .titleBar({
      style: {
        scrollEffectStyle: {
          backgroundStyle: {
            backgroundColor: $r('sys.color.ohos_id_color_background_transparent'),
          },
          contentStyle: {
            titleStyle: {
              mainTitleColor: $r('sys.color.font_on_tertiary'),
            },
            menuStyle: {
              backgroundColor: $r('sys.color.comp_background_tertiary'),
              iconColor: $r('sys.color.icon_on_tertiary')
            },
            backIconStyle: {
              backgroundColor: $r('sys.color.comp_background_tertiary'),
              iconColor: $r('sys.color.icon_on_tertiary')
            }
          }
        },
        originalStyle: {
          contentStyle: {
            titleStyle: {
              mainTitleColor: Color.White,
            },
            backIconStyle: {
              backgroundColor: $r('sys.color.comp_background_tertiary'),
              iconColor: $r('sys.color.icon_primary')
            }
          }
        }
      },
      content: {
        title: { mainTitle: 'é…ç½®' },
      },
      avoidLayoutSafeArea: true
    })
    }
    .width('100%')
    .height('100%')
  }
  
  @Builder
  OptionSheetBuilder() {
    OptionSelectorSheet({
      title: this.sheetTitle,
      description: this.sheetDescription,
      options: this.sheetOptions,
      selectedIndex: this.sheetSelectedIndex,
      isDarkMode: this.isDarkMode,
      isLightEffectBright: this.isLightEffectBright,
      onSelect: (index: number) => {
        this.sheetSelectedIndex = index;
        this.handleSheetSelect(index);
      },
      onClose: () => {
        this.isOptionSheetVisible = false;
      }
    })
  }
}
